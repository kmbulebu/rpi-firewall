- name: Enable IPv4 forwarding
  sysctl:
    name: net.ipv4.ip_forward
    value: '1'
    sysctl_file: /etc/sysctl.d/20-router.conf
    reload: yes
    sysctl_set: yes
- name: Enable IPv6 forwarding
  sysctl:
    name: net.ipv6.conf.all.forwarding
    value: '1'
    sysctl_file: /etc/sysctl.d/20-router.conf
    reload: yes
    sysctl_set: yes
- name: Enable IPv6 forwarding
  sysctl:
    name: net.ipv6.conf.default.forwarding
    value: '1'
    sysctl_file: /etc/sysctl.d/20-router.conf
    reload: yes
    sysctl_set: yes
- name: Increase IPV6 Route Cache Max
  sysctl:
    name: net.ipv6.route.max_size
    value: '262144'
    sysctl_file: /etc/sysctl.d/20-router.conf
    reload: yes
    sysctl_set: yes
- name: Use Liberal Netfilter Connection Tracking
  sysctl:
    name: net.netfilter.nf_conntrack_tcp_be_liberal
    value: '1'
    sysctl_file: /etc/sysctl.d/20-router.conf
    reload: yes
    sysctl_set: yes
- name: Expand ephemeral port range
  sysctl:
    name: net.ipv4.ip_local_port_range
    value: '10000 65535'
    sysctl_file: /etc/sysctl.d/20-router.conf
    reload: yes
    sysctl_set: yes
- name: Adjust net_rx_action budget
  sysctl:
    name: net.core.netdev_budget
    value: '500'
    sysctl_file: /etc/sysctl.d/20-router.conf
    reload: yes
    sysctl_set: yes
- name: Adjust Receive Packet Streeting on WAN Interface
  sysctl:
    name: /sys/class/net/{{ wan_iface }}/queues/rx-0/rps_cpus 
    value: '1' # 0001 CPU core 1
    sysctl_file: /etc/sysctl.d/20-router.conf
    reload: yes
    sysctl_set: yes
- name: Adjust Receive Packet Streeting on LAN Interface
  sysctl:
    name: /sys/class/net/{{ lan_iface }}/queues/rx-0/rps_cpus 
    value: '2' # 0010 CPU core 2
    sysctl_file: /etc/sysctl.d/20-router.conf
    reload: yes
    sysctl_set: yes