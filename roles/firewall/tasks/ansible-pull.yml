---
- name: Setup ansible-pull config
  ansible.builtin.template:
    src: ansible-pull/ansible-pull
    dest: /etc/default/ansible-pull
    owner: root
    ansible.builtin.group: root
    mode: '0640'
- name: Setup ansible-pull service
  ansible.builtin.copy:
    src: ansible-pull/ansible-pull.service
    dest: /etc/systemd/system/ansible-pull.service
    owner: root
    ansible.builtin.group: root
    mode: '0644'
  notify: systemctl daemon-reload
- name: Setup ansible-pull-reconfigure service
  ansible.builtin.copy:
    src: ansible-pull/ansible-pull-reconfigure.service
    dest: /etc/systemd/system/ansible-pull-reconfigure.service
    owner: root
    ansible.builtin.group: root
    mode: '0644'
  notify: systemctl daemon-reload
- name: Setup ansible-pull timer
  ansible.builtin.copy:
    src: ansible-pull/ansible-pull.timer
    dest: /etc/systemd/system/ansible-pull.timer
    owner: root
    ansible.builtin.group: root
    mode: '0644'
  notify: systemctl daemon-reload
- name: Setup ansible-pull-reconfigure path watch
  ansible.builtin.template:
    src: ansible-pull/ansible-pull-reconfigure.path
    dest: /etc/systemd/system/ansible-pull-reconfigure.path
    owner: root
    ansible.builtin.group: root
    mode: '0644'
  notify: systemctl daemon-reload
- name: systemctl daemon-reload
  ansible.builtin.systemd:
    daemon_reload: yes
- name: Setup ansible-pull.service
  ansible.builtin.systemd:
    name: ansible-pull.service
    enabled: no # Do not run on boot, only on timer trigger.
    masked: no
- name: Enable ansible-pull.timer
  ansible.builtin.systemd:
    name: ansible-pull.timer
    enabled: yes
    state: started
    masked: no
- name: Setup ansible-pull-reconfigure.service
  ansible.builtin.systemd:
    name: ansible-pull-reconfigure.service
    enabled: no # Do not run on boot, only on path trigger.
    masked: no
- name: Enable ansible-pull-reconfigure.path
  ansible.builtin.systemd:
    name: ansible-pull-reconfigure.path
    enabled: yes
    state: started
    masked: no
